openapi: 3.0.3
info:
  title: Kit
  version: 0.1.0
  description: |-
    
tags:
  - name: Cluster
    description: Endpoints to manage and interact with the cluster (Enterprise Only)
  - name: SQL
    description: Endpoints to interact with the underlying data
  - name: Sources
    description: Endpoints to manage and interact with data sources
  - name: Catalogs
    description: Endpoints to manage and interact with data catalogs
  - name: IAM
    description: Identity access management endpoints
paths:
  /v1/cluster:
    get:
      tags:
      - Cluster
      summary: Get information about the current cluster
      operationId: getCluster
      responses:
        '200':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cluster'
        '400':
          description: The user is unauthorised to create a new catalog
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespace/{namespace}/query:
    get:
      tags:
        - SQL
      summary: Interact with the data catalogs through SQL
      description: Interact with the configured underlying data catalogs using SQL.
      operationId: query
      parameters:
        - in: path
          name: namespace
          schema:
            type: string
          required: true
          description: Unique namespace identifier
        - name: statements
          in: query
          description: SQL query statements to be executed
          required: true
          schema:
            type: string
      responses:
        '200':
          description: The query has executed successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Rows'
        '400':
          description: Invalid SQL query. This status code is returned whenever the returned SQL query is invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
        '401':
          description: The user is unauthorised to access one or more of the requested data catalogs.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespace/{namespace}/sources:
    get:
      tags:
        - Sources
      summary: Fetch all sources
      description: Fetch all sources within a given catalog
      operationId: getSources
      parameters:
        - in: path
          name: namespace
          schema:
            type: string
          required: true
          description: Unique namespace identifier
      responses:
        '200':
          description: ""
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sources'
        '401':
          description: The user is unauthorised to access the sources within the given namespace
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespace/{namespace}/source:
    post:
      tags:
      - Sources
      summary: Create a new source
      description: Create a new catalog source using the given parameters
      operationId: newSource
      parameters:
        - in: path
          name: namespace
          schema:
            type: string
          required: true
          description: Unique namespace identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewSource'
      responses:
        '201':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Source'
        '401':
          description: The user is unauthorised to create a new source
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespace/{namespace}/source/{source}:
    get:
      tags:
        - Sources
      summary: Fetch the source details within the given catalog
      description: Retreive the source details within the a given catalog matching the given source id.
      operationId: getSource
      parameters:
        - in: path
          name: namespace
          schema:
            type: string
          required: true
          description: Unique namespace identifier
        - in: path
          name: source
          schema:
            type: string
          required: true
          description: Unique source identifier
      responses:
        '200':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Source'
        '404':
          description: The requested source has not been found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
        '401':
          description: The user is unauthorised to access the given source.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
    delete:
      tags:
        - Sources
      summary: Delete a single catalog source
      description: Delete a single catalog source
      operationId: deleteSource
      parameters:
        - in: path
          name: namespace
          schema:
            type: string
          required: true
          description: Unique namespace identifier
        - in: path
          name: source
          schema:
            type: string
          required: true
          description: Unique source identifier
      responses:
        '200':
          description: The source has been deleted
        '401':
          description: The user is unauthorised to delete the given source
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespace/{namespace}/source/{source}/options:
    get:
      tags:
        - Sources
      summary: Fetch the source options within the given catalog
      description: Retreive the source options within the a given catalog matching the given source id.
      operationId: getSourceOptions
      parameters:
        - in: path
          name: namespace
          schema:
            type: string
          required: true
          description: Unique namespace identifier
        - in: path
          name: source
          schema:
            type: string
          required: true
          description: Unique source identifier
      responses:
        '200':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SourceOptions'
        '401':
          description: The user is unauthorised to access the given source options.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespace/{namespace}/source/{source}/fetch:
    get:
      tags:
        - Sources
      summary: Fetch the latest source tables and schemas
      description: Fetch the latest source tables and schemas and update the internal definitions
      operationId: fetchSource
      parameters:
        - in: path
          name: namespace
          schema:
            type: string
          required: true
          description: Unique namespace identifier
        - in: path
          name: source
          schema:
            type: string
          required: true
          description: Unique source identifier
      responses:
        '200':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Source'
        '401':
          description: The user is unauthorised to fetch the latest source schemas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespace/{namespace}/catalog:
    post:
      tags:
      - Catalogs
      summary: Post a new catalog
      description: Create a new catalog using the given parameters
      operationId: newCatalog
      parameters:
        - in: path
          name: namespace
          schema:
            type: string
          required: true
          description: Unique namespace identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetCatalog'
      responses:
        '201':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Catalog'
        '401':
          description: The user is unauthorised to create a new catalog
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespace/{namespace}/catalog/{catalog}:
    get:
      tags:
        - Catalogs
      summary: Fetch all data sets within the given catalog
      description: Fetch all data sets within a given catalog
      operationId: getCatalog
      parameters:
        - in: path
          name: namespace
          schema:
            type: string
          required: true
          description: Unique namespace identifier
        - in: path
          name: catalog
          schema:
            type: string
          required: true
          description: Unique catalog identifier
      responses:
        '200':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Catalog'
        '401':
          description: The user is unauthorised to get all tables.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
    put:
      tags:
      - Catalogs
      summary: Add a table to a catalog
      description: Attempts to add the given dataset to the given catalog
      operationId: updateCatalog
      parameters:
        - in: path
          name: namespace
          schema:
            type: string
          required: true
          description: Unique namespace identifier
        - in: path
          name: catalog
          schema:
            type: string
          required: true
          description: Unique catalog identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetCatalog'
      responses:
        '201':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Catalog'
        '400':
          description: The user is unauthorised to create a new catalog
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
    delete:
      tags:
        - Catalogs
      summary: Delete a single catalog
      description: Delete a single catalog
      operationId: deleteCatalog
      parameters:
        - in: path
          name: namespace
          schema:
            type: string
          required: true
          description: Unique namespace identifier
        - in: path
          name: catalog
          schema:
            type: string
          required: true
          description: Unique catalog identifier
      responses:
        '200':
          description: The catalog has been deleted
        '401':
          description: The user is unauthorised to delete the given catalog
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespace/{namespace}/catalogs:
    get:
      tags:
        - Catalogs
      summary: Fetch all data catalogs
      description: Fetches all configured catalogs
      operationId: getCatalogs
      parameters:
        - in: path
          name: namespace
          schema:
            type: string
          required: true
          description: Unique namespace identifier
      responses:
        '200':
          description: 
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Catalogs'
  /v1/user:
    post:
      tags:
        - IAM
      summary: Create a user
      description: Create a user account within the cluster.
      operationId: newUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewUser'
      responses:
        '201':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
  /v1/user/{id}:
    get:
      tags:
        - IAM
      summary: Get a user matching the given id
      description: Get a user matching the given id.
      operationId: getUser
      parameters:
      - in: path
        name: id
        schema:
          type: integer
          format: uint64
        required: true
        description: Unique user identifier
      responses:
        '200':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: no record
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
    delete:
      tags:
        - IAM
      summary: Delete a single user
      description: Delete a single user
      operationId: deleteUser
      parameters:
      - in: path
        name: id
        schema:
          type: integer
          format: uint64
        required: true
        description: Unique user identifier
      responses:
        '200':
          description: The user has been deleted
        '401':
          description: The user is unauthorised to delete the given user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespaces:
    get:
      tags:
        - IAM
      summary: Retreive all namespaces
      description: Retreive all namespaces that the given user is part of.
      operationId: getAllNamespaces
      responses:
        '200':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Namespaces'
              example: 
                - name: default
                - name : Arya_Stark
        '401':
          description: The user is unauthorised to retreive an overview of all namespaces.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespace:
    post:
      tags:
        - IAM
      summary: Create a new namespace
      description: Create a new namespace within the cluster.
      operationId: newNamespace
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewNamespace'
      responses:
        '200':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Namespace'
        '400':
          description: Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespace/{namespace}:
    delete:
      tags:
        - IAM
      summary: Delete a single namespace
      description: Delete a single namespace.
      operationId: deleteNamespace
      parameters: 
      - in: path
        name: namespace
        example: default 
        schema:
          type: string
        required: true
        description: Unique namespace identifier
      responses:
        '200':
          description: The namespace has been deleted
        '401':
          description: The user is unauthorised to delete the given namespace
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespace/{namespace}/service_account:
    post:
      tags:
        - IAM
      summary: Add a new service account to the given namespace
      description: Add a new service account to the given namespace.
      operationId: newNamespaceServiceAccount
      parameters:
      - in: path
        name: namespace
        schema:
          type: string
        required: true
        description: Unique namespace identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewServiceAccount'
      responses:
        '201':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceAccount'
        '401':
          description: The user is unauthorised to post a new service account.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespace/{namespace}/service_account/{service_id}:
    get:
      tags:
        - IAM
      summary: Get a single service account within a namespace
      description: Get a single service account registered within the given namespace.
      operationId: getNamespaceServiceAccount
      parameters:
      - in: path
        name: namespace
        schema:
          type: string
        required: true
        description: Unique namespace identifier
      - in: path
        name: service_id
        schema:
          type: integer
          format: uint64
        required: true
        description: Unique service account identifier
      responses:
        '200':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceAccount'
        '401':
          description: The user is unauthorised to retreive the details of a service account within the given namespace.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
    delete:
      tags:
        - IAM
      summary: Delete a single service account within a namespace
      description: Delete a single service account registered within the given namespace.
      operationId: deleteNamespaceServiceAccount
      parameters:
      - in: path
        name: namespace
        schema:
          type: string
        required: true
        description: Unique namespace identifier
      - in: path
        name: service_id
        schema:
          type: integer
          format: uint64
        required: true
        description: Unique service account identifier
      responses:
        '200':
          description: The service account has been deleted
        '401':
          description: The user is unauthorised to delete a service account within the given namespace.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /v1/namespace/{namespace}/service_accounts:
    get:
      tags:
        - IAM
      summary: Retreive all service accounts of a given namespace
      description: Retreive all service accounts registered within the given namespace.
      operationId: getNamespaceServiceAccounts
      parameters:
      - in: path
        name: namespace
        schema:
          type: string
        required: true
        description: Unique namespace identifier
      responses:
        '200':
          description:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceAccounts'
        '401':
          description: The user is unauthorised to retreive an overview of all service accounts.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
components:
  schemas:
    Problem:
      type: object
      required:
        - title
        - detail
      properties:
        title:
          type: string
          description: >
            A short summary of the problem type. Written in English and readable
            for engineers, usually not suited for non technical stakeholders and
            not localized.
          example: some title for the error situation
        detail:
          type: string
          description: >
            A human readable explanation specific to this occurrence of the
            problem that is helpful to locate the problem and give advice on how
            to proceed. Written in English and readable for engineers, usually not
            suited for non technical stakeholders and not localized.
          example: some description for the error situation
    Rows:
      type: object
      required:
        - columns
        - rows
      properties:
        columns:
          type: array
          items:
            $ref: '#/components/schemas/Column'
          example:
            - name: Jon
              type: string
              cap: 256 
            - name: Snow
              type: string
              cap: 256
        rows:
          type: array
          items:
            type: array
            items:
              type: string
              nullable: true
            example:
              - Jon
              - null
    Column:
      type: object
      required:
        - id
        - name
        - type
        - cap
        - nullable
      properties:
        id:
          type: integer
          format: uint64
          example: 8
        name:
          type: string
          example: weirwood_tree
        type:
          type: string
          example: string
        cap:
          type: integer
          format: uint64
          example: 85
        nullable:
          type: boolean
          example: true
    Catalogs:
      type: array
      items:
        $ref: '#/components/schemas/Catalog'
    Catalog:
      type: object
      required:
        - id
        - name
        - description
        - labels
        - tables
      properties:
        id:
          type: integer
          format: uint64
          example: 3
        name:
          type: string
          example: winterfell
        description:
          type: string
          example: nice city could use a bit more defence
        labels:
          type: array
          nullable: true
          items:
            type: string
            example: cold, old, nice people
        tables:
          $ref: '#/components/schemas/Tables'
    SetCatalog:
      type: object
      required:
        - name
        - description
        - labels
        - tables
      properties:
        name:
          type: string
          description: the catalog name referenced within SQL queries
        description:
          type: string
        labels:
          type: array
          items:
            type: string
        tables:
          type: array
          items:
              $ref: '#/components/schemas/UpsertTable'
    UpsertTable:
      type: object
      required:
        - id
        - name
        - schema
      properties:
        id:
          type: integer
          format: uint64
        name:
          type: string
          description: the table name referenced within SQL queries
        schema:
          type: string
          default: public
          description: the table schema referenced within SQL queries
    Sources:
      type: array
      items:
        $ref: '#/components/schemas/Source'
    Source:
      type: object
      required:
        - id
        - name
        - connector
        - healthy
        - tables
      properties:
        id:
          type: integer
          format: uint64
          example: 7
        name:
          type: string
          example: "Arya_Stark"
        connector:
          type: string
          example: "postgres"
          description: represents the connector name used to connect with the given source
        healthy:
          type: boolean
        tables:
          $ref: '#/components/schemas/Tables'
    NewSource:
      type: object
      required:
        - name
        - connector
        - options
      properties:
        name:
          type: string
          example: "Customer Service"
        connector:
          type: string
          example: "postgresql"
          description: represents the connector name used to connect with the given source
        options:
          $ref: '#/components/schemas/SourceOptions'
    SourceOptions:
      type: object
      additionalProperties:
        type: string
      example:
        host: 127.0.0.1
        port: "5321"
    Tables:
      type: array
      items:
        $ref: '#/components/schemas/Table'
    Table:
      type: object
      required:
        - id
        - source_id
        - name
        - schema
        - schemaless
        - columns
        - type
      properties:
        id:
          type: integer
          format: uint64
        source_id:
          type: integer
          format: uint64
        name:
          type: string
          example: invoices
        schema:
          type: string
          example: public
        schemaless:
          type: boolean
          example: true
        columns:
          type: array
          items:
            $ref: '#/components/schemas/Column'
    NewNamespace:
      type: object
      required:
        - name
      properties:
        name:
          type: string
    Namespaces:
      type: array
      items:
        $ref: '#/components/schemas/Namespace'
    Namespace:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          example: Jon_Snow
    NewUser:
      type: object
      required:
        - full_name
        - username
        - email
        - password
      properties:
        full_name:
          type: string
        username:
          type: string
        email:
          type: string
          format: email
          x-go-type: string
        password:
          type: string
    User:
      type: object
      required:
        - id
        - full_name
        - username
        - email
      properties:
        id:
          type: integer
          format: uint64
          example: 9
        username:
          type: string
          example: Jon
        full_name:
          type: string
          example: Jon_Snow 
        email:
          type: string
          format: email
          x-go-type: string
          example: Jonsnow@gmail.com
    NewServiceAccount:
      type: object
      required:
        - id
        - name
        - description
        - labels
      properties:
        principal:
          type: string
        name:
          type: string
        description:
          type: string
        labels:
          type: array
          items:
            type: string
    ServiceAccounts:
      type: array
      items:
        $ref: '#/components/schemas/ServiceAccount'
    ServiceAccount:
      type: object
      required:
        - principal
        - name
        - description
        - labels
      properties:
        principal:
          type: string
          format: email
          example: Jonsnow@gmail.com
        name:
          type: string
          example: Jon_Snow
        description:
          type: string
          example: leader of the nightswatch
        labels:
          type: array
          items:
            type: string
            example: leader, wolf lover, bastard
    Cluster:
      type: object
      required:
        - leader
        - healthy
        - nodes
      properties:
        leader:
          type: integer
          format: uint64
        healthy:
          type: boolean
        nodes:
          type: array
          items:
            $ref: '#/components/schemas/Node'
    Node:
      type: object
      required:
        - id
        - address
        - healthy
        - ready
      properties:
        id:
          type: integer
          format: uint64
        address:
          type: string
          example: "Winterfell"
        healthy:
          type: boolean
        ready:
          type: boolean